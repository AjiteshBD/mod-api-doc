
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../06_data_extraction___transformation_/">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.12">
    
    
      
        <title>Chapter 7: JSON Output Formatter - Backend-mod-api-php</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.2afb09e1.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="https://unpkg.com/mermaid@10.9.1/dist/mermaid.min.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#chapter-7-json-output-formatter" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Backend-mod-api-php" class="md-header__button md-logo" aria-label="Backend-mod-api-php" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Backend-mod-api-php
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Chapter 7: JSON Output Formatter
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Backend-mod-api-php" class="md-nav__button md-logo" aria-label="Backend-mod-api-php" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Backend-mod-api-php
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tutorial: Backend-mod-api-php
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../01_pdf_type_detector_/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 1: PDF Type Detector
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../02_state_format_specific_parser_/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 2: State/Format Specific Parser
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../03_pdfminer_parser_engine_/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 3: PDFMiner Parser Engine
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../04_ocr_parser_engine_/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 4: OCR Parser Engine
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../05_layout_analyzer_/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 5: Layout Analyzer
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../06_data_extraction___transformation_/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 6: Data Extraction &amp; Transformation
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Chapter 7: JSON Output Formatter
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Chapter 7: JSON Output Formatter
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#the-problem-delivering-data-consistently" class="md-nav__link">
    <span class="md-ellipsis">
      The Problem: Delivering Data Consistently
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-solution-the-json-output-formatter-our-report-writer" class="md-nav__link">
    <span class="md-ellipsis">
      The Solution: The JSON Output Formatter - Our Report Writer
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#key-concepts-json-structure-and-standardization" class="md-nav__link">
    <span class="md-ellipsis">
      Key Concepts: JSON Structure and Standardization
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-it-works-filling-the-template" class="md-nav__link">
    <span class="md-ellipsis">
      How It Works: Filling the Template
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-json-output-structure" class="md-nav__link">
    <span class="md-ellipsis">
      Example JSON Output Structure
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#code-snippet-generating-the-json" class="md-nav__link">
    <span class="md-ellipsis">
      Code Snippet: Generating the JSON
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      Conclusion
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#the-problem-delivering-data-consistently" class="md-nav__link">
    <span class="md-ellipsis">
      The Problem: Delivering Data Consistently
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-solution-the-json-output-formatter-our-report-writer" class="md-nav__link">
    <span class="md-ellipsis">
      The Solution: The JSON Output Formatter - Our Report Writer
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#key-concepts-json-structure-and-standardization" class="md-nav__link">
    <span class="md-ellipsis">
      Key Concepts: JSON Structure and Standardization
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-it-works-filling-the-template" class="md-nav__link">
    <span class="md-ellipsis">
      How It Works: Filling the Template
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-json-output-structure" class="md-nav__link">
    <span class="md-ellipsis">
      Example JSON Output Structure
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#code-snippet-generating-the-json" class="md-nav__link">
    <span class="md-ellipsis">
      Code Snippet: Generating the JSON
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      Conclusion
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="chapter-7-json-output-formatter">Chapter 7: JSON Output Formatter</h1>
<p>Welcome to the final chapter! In <a href="../06_data_extraction___transformation_/">Chapter 6: Data Extraction &amp; Transformation</a>, we saw how the system pulls out the specific data values we need (like '12345' for Risk ID) and cleans them up (like removing '$' or extra spaces from '$ 100,000.00' to get '100000.00').</p>
<p>Now we have all these individual pieces of clean data, possibly gathered from different parts of the document or even multiple pages. But how do we package everything up neatly so that other computer systems can easily use this information?</p>
<h2 id="the-problem-delivering-data-consistently">The Problem: Delivering Data Consistently</h2>
<p>Imagine you've gathered all the details for a complex project â€“ notes here, numbers there, dates on another page. Now you need to present this information to your boss or another team. You wouldn't just hand them a messy pile of notes, right? They need a clear, organized report in a format they expect.</p>
<p>Similarly, after our system extracts <code>risk_id</code>, <code>rating_effective_date</code>, payroll numbers, claim details, etc., it needs to present this data in a consistent, predictable way. Other software systems that use this data (maybe for analysis, storage, or display) rely on knowing <em>exactly</em> where to find each piece of information in the output. They need a standard "report template" filled out correctly every time.</p>
<h2 id="the-solution-the-json-output-formatter-our-report-writer">The Solution: The JSON Output Formatter - Our Report Writer</h2>
<p>This is the final step in our PDF processing journey: the <strong>JSON Output Formatter</strong>. Think of it as the meticulous report writer who takes all the cleaned-up data points collected by the <a href="../02_state_format_specific_parser_/">State/Format Specific Parser</a> (after the <a href="../06_data_extraction___transformation_/">Data Extraction &amp; Transformation</a> steps) and arranges them into a perfectly structured final report.</p>
<p>This "report" uses a format called <strong>JSON</strong> (JavaScript Object Notation). JSON is a very popular way for computer systems to exchange data because it's easy for both humans to read (sort of!) and machines to parse.</p>
<p>The JSON Output Formatter's main job is:</p>
<ol>
<li><strong>Assembling:</strong> Gather all the extracted and transformed data for the entire document.</li>
<li><strong>Structuring:</strong> Organize this data into a predefined structure using specific <strong>keys</strong> (labels) and <strong>nesting</strong> (putting data inside other data categories).</li>
<li><strong>Standardizing:</strong> Ensure the output <em>always</em> follows the same format, regardless of which type of PDF was processed initially.</li>
</ol>
<h2 id="key-concepts-json-structure-and-standardization">Key Concepts: JSON Structure and Standardization</h2>
<ul>
<li><strong>JSON Basics:</strong> JSON uses key-value pairs. Think of it like a dictionary or a list of labeled items. A <strong>key</strong> is a label (like <code>"risk_name"</code>), and a <strong>value</strong> is the data associated with that label (like <code>"ACME Corp"</code>). Values can be text (strings), numbers, lists (arrays), or even other JSON objects (nesting).</li>
<li><strong>Predefined Structure:</strong> The <code>Backend-mod-api-php</code> project expects the output JSON to have a very specific structure. This includes top-level keys (like <code>"id"</code>, <code>"file_name"</code>) and a special key, often <code>"merged_amit_data_edit"</code>, which holds a list containing the detailed extracted data points for each relevant record found in the PDF.</li>
<li><strong>Consistency:</strong> By formatting everything into this standard JSON, the system guarantees that any downstream application knows exactly how to find the <code>risk_id</code>, the <code>policy_no</code>, or the table of <code>payroll</code> and <code>losses</code> data, regardless of whether the original PDF was an NCCI form, a California form, or a scanned document processed via OCR.</li>
</ul>
<h2 id="how-it-works-filling-the-template">How It Works: Filling the Template</h2>
<ol>
<li><strong>Input:</strong> The <a href="../02_state_format_specific_parser_/">State/Format Specific Parser</a> finishes its work. It has collected all the cleaned data, often storing it internally in a Python data structure like a list of dictionaries. Each dictionary might represent a row or a record from the PDF.</li>
<li><strong>Mapping:</strong> The formatting logic takes this internal Python structure and maps it to the required JSON structure. It assigns the extracted values to the predefined JSON keys.</li>
<li><strong>Conversion:</strong> It uses Python's built-in <code>json</code> library to convert the Python data structure into a JSON formatted string.</li>
<li><strong>Output:</strong> The final output is a text string containing the structured JSON data, ready to be sent back to the main PHP application or saved.</li>
</ol>
<p>Let's visualize this final step:</p>
<pre class="mermaid"><code>sequenceDiagram
    participant Parser as State/Format Specific Parser
    participant CleanData as Python Data (List of Dicts)
    participant Formatter as JSON Output Formatter Logic
    participant FinalJSON as JSON String Output

    Parser-&gt;&gt;CleanData: Store extracted data: [{'risk_id': '123', 'payroll': 10000}, ...]
    Parser-&gt;&gt;Formatter: Format this data into standard JSON
    Formatter-&gt;&gt;CleanData: Get structured data
    Formatter-&gt;&gt;Formatter: Map data to JSON keys ('risk_id' -&gt; "risk_id", etc.)
    Formatter-&gt;&gt;Formatter: Define overall JSON structure (incl. "merged_amit_data_edit")
    Formatter-&gt;&gt;FinalJSON: Convert Python data to JSON string using json.dumps()
    Formatter--&gt;&gt;Parser: Return JSON String</code></pre>
<h2 id="example-json-output-structure">Example JSON Output Structure</h2>
<p>Here's a <em>simplified</em> example of what the final JSON output might look like:</p>
<div class="highlight"><pre><span></span><code><span class="p">[</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="c1">// Often filled in later by the main system</span>
<span class="w">    </span><span class="nt">&quot;document_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="c1">// Often filled in later</span>
<span class="w">    </span><span class="nt">&quot;remote_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="c1">// Often filled in later</span>
<span class="w">    </span><span class="nt">&quot;file_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;my_mod_form.pdf&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;media_link&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="c1">// Often filled in later</span>
<span class="w">    </span><span class="nt">&quot;media_link_original&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="c1">// Often filled in later</span>
<span class="w">    </span><span class="nt">&quot;media_link_data&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="c1">// Often filled in later</span>
<span class="w">    </span><span class="nt">&quot;page_count&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;3&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;uploaded_at&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="c1">// Often filled in later</span>
<span class="w">    </span><span class="nt">&quot;processed_at&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="c1">// Often filled in later</span>
<span class="w">    </span><span class="nt">&quot;merged_amit_data_edit&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;risk_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ACME Corp&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;risk_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1234567&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;rating_effective_date&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;01/01/2024&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;production_date&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;12/15/2023&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;state&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;NCCI&quot;</span><span class="p">,</span><span class="w"> </span><span class="c1">// Or &quot;CA&quot;, &quot;MI&quot;, etc.</span>
<span class="w">        </span><span class="nt">&quot;carrier&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Carrier ABC&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;policy_no&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;WC123456&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;policy_no_sub&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="c1">// Sub-policy number if applicable</span>
<span class="w">        </span><span class="nt">&quot;eff_date&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;01/01/2023&quot;</span><span class="p">,</span><span class="w"> </span><span class="c1">// Policy specific eff date</span>
<span class="w">        </span><span class="nt">&quot;exp_date&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;01/01/2024&quot;</span><span class="p">,</span><span class="w"> </span><span class="c1">// Policy specific exp date</span>
<span class="w">        </span><span class="nt">&quot;code&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;8810&quot;</span><span class="p">,</span><span class="w"> </span><span class="c1">// Class code</span>
<span class="w">        </span><span class="nt">&quot;elr&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0.55&quot;</span><span class="p">,</span><span class="w"> </span><span class="c1">// Expected Loss Rate</span>
<span class="w">        </span><span class="nt">&quot;dratio&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0.60&quot;</span><span class="p">,</span><span class="w"> </span><span class="c1">// D-Ratio</span>
<span class="w">        </span><span class="nt">&quot;payroll&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;100000&quot;</span><span class="p">,</span><span class="w"> </span><span class="c1">// Payroll amount (often as string)</span>
<span class="w">        </span><span class="nt">&quot;expected_losses&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;550&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;exp_prim_losses&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;330&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;claim_data&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;CLAIMXYZ&quot;</span><span class="p">,</span><span class="w"> </span><span class="c1">// Claim identifier</span>
<span class="w">        </span><span class="nt">&quot;ij&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;01&quot;</span><span class="p">,</span><span class="w"> </span><span class="c1">// Injury code</span>
<span class="w">        </span><span class="nt">&quot;of&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;*&quot;</span><span class="p">,</span><span class="w"> </span><span class="c1">// Open/Final status</span>
<span class="w">        </span><span class="nt">&quot;act_inc_losses&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;5000&quot;</span><span class="p">,</span><span class="w"> </span><span class="c1">// Actual Incurred Losses</span>
<span class="w">        </span><span class="nt">&quot;act_prim_losses&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;3000&quot;</span><span class="p">,</span><span class="w"> </span><span class="c1">// Actual Primary Losses</span>
<span class="w">        </span><span class="nt">&quot;claim_abbrevation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="c1">// e.g., (M) for Medical Only</span>
<span class="w">        </span><span class="nt">&quot;class_code_claim&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="c1">// Class code associated with claim</span>
<span class="w">        </span><span class="nt">&quot;statecode&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0-NCCI&quot;</span><span class="p">,</span><span class="w"> </span><span class="c1">// Internal state code</span>
<span class="w">        </span><span class="nt">&quot;Policy Total&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;150000&quot;</span><span class="p">,</span><span class="w"> </span><span class="c1">// Total Payroll for policy period</span>
<span class="w">        </span><span class="nt">&quot;Subject Premium&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0&quot;</span><span class="p">,</span><span class="w"> </span><span class="c1">// Subject Premium</span>
<span class="w">        </span><span class="nt">&quot;Total Act Inc Losses&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;8000&quot;</span><span class="w"> </span><span class="c1">// Total Losses for policy period</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// ... another record/row from the PDF ...</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">]</span>
</code></pre></div>
<ul>
<li><strong>Key takeaway:</strong> Notice the consistent keys like <code>"risk_name"</code>, <code>"policy_no"</code>, <code>"payroll"</code>, and how the detailed data is nested within the <code>"merged_amit_data_edit"</code> list. This structure makes it easy for other programs to reliably access the information.</li>
</ul>
<h2 id="code-snippet-generating-the-json">Code Snippet: Generating the JSON</h2>
<p>The actual JSON generation is usually straightforward using Python's <code>json</code> library. The complex part is assembling the Python dictionary (<code>global_list</code> in many parser scripts) correctly <em>before</em> this final step.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">json</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">j</span> <span class="c1"># Import the json library (often aliased as j)</span>

<span class="c1"># Assume &#39;global_list&#39; is a Python list containing a dictionary</span>
<span class="c1"># which holds all the extracted data, including the &#39;merged_amit_data_edit&#39; list.</span>
<span class="c1"># This structure is built up throughout the parser script.</span>
<span class="n">global_list</span> <span class="o">=</span> <span class="p">[</span>
  <span class="p">{</span>
    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;document_id&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;remote_id&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="s2">&quot;my_mod_form.pdf&quot;</span><span class="p">,</span>
    <span class="s2">&quot;media_link&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;media_link_original&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;media_link_data&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="s2">&quot;page_count&quot;</span><span class="p">:</span> <span class="s2">&quot;3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;uploaded_at&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;processed_at&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="s2">&quot;merged_amit_data_edit&quot;</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="s2">&quot;risk_name&quot;</span><span class="p">:</span> <span class="s2">&quot;ACME Corp&quot;</span><span class="p">,</span> <span class="s2">&quot;risk_id&quot;</span><span class="p">:</span> <span class="s2">&quot;1234567&quot;</span><span class="p">,</span> <span class="c1"># ... other fields ...</span>
        <span class="s2">&quot;payroll&quot;</span><span class="p">:</span> <span class="s2">&quot;100000&quot;</span><span class="p">,</span> <span class="s2">&quot;act_inc_losses&quot;</span><span class="p">:</span> <span class="s2">&quot;5000&quot;</span><span class="p">,</span> <span class="c1"># ... etc ...</span>
      <span class="p">},</span>
      <span class="c1"># ... more dictionaries for other records ...</span>
    <span class="p">]</span>
  <span class="p">}</span>
<span class="p">]</span>

<span class="c1"># Define the output path for the JSON file</span>
<span class="n">output_path</span> <span class="o">=</span> <span class="s2">&quot;output/my_mod_form.json&quot;</span>

<span class="c1"># Open the output file for writing</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
  <span class="c1"># Use json.dump() to write the Python data to the file as JSON</span>
  <span class="c1"># &#39;indent=4&#39; makes the output nicely formatted and readable</span>
  <span class="n">j</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">global_list</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;JSON output saved to: </span><span class="si">{</span><span class="n">output_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<ul>
<li><strong>Explanation:</strong> This code takes the final Python data structure (<code>global_list</code>) which contains all the information organized according to the required output keys. It then uses <code>j.dump()</code> (which stands for "dump to JSON") to convert this Python structure into a JSON formatted string and write it directly into the specified output file (<code>output_path</code>). The <code>indent=4</code> argument simply adds spacing to make the resulting JSON file easier for humans to read. This final JSON file is the ultimate output of the Python parsing process for that PDF.</li>
</ul>
<p>This JSON formatting step is typically the very last action performed by the specific parser scripts (like <code>pdf_parser.py</code>, <code>ocrCA.py</code>, <code>pdf_parser_ncci2.py</code>, etc.) before they finish.</p>
<h2 id="conclusion">Conclusion</h2>
<p>The JSON Output Formatter is the final, crucial step that brings everything together. It takes all the data meticulously extracted, cleaned, and transformed by the previous stages (<a href="../05_layout_analyzer_/">Layout Analyzer</a> and <a href="../06_data_extraction___transformation_/">Data Extraction &amp; Transformation</a>) and formats it into a standardized JSON structure.</p>
<p>This ensures that the output is consistent and predictable, using predefined keys like <code>risk_name</code>, <code>policy_no</code>, and the important <code>merged_amit_data_edit</code> list. This allows other parts of the <code>Backend-mod-api-php</code> system, or any other consuming application, to reliably use the extracted data.</p>
<hr />
<p>This concludes our journey through the core components of the <code>Backend-mod-api-php</code> PDF processing pipeline. We started by identifying the PDF type, selecting the right parser, using engines like PDFMiner or OCR to read the text, analyzing the layout, extracting and cleaning the data, and finally, formatting it into a standard JSON output. Hopefully, this gives you a much clearer picture of how the system works!</p>
<hr />












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.c8b220af.min.js"></script>
      
        <script src="https://unpkg.com/mermaid@10.9.1/dist/mermaid.min.js"></script>
      
    
  </body>
</html>