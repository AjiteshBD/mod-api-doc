
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../01_pdf_type_detector_/">
      
      
        <link rel="next" href="../03_pdfminer_parser_engine_/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.12">
    
    
      
        <title>Chapter 2: State/Format Specific Parser - Backend-mod-api-php</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.2afb09e1.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="https://unpkg.com/mermaid@10.9.1/dist/mermaid.min.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#chapter-2-stateformat-specific-parser" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Backend-mod-api-php" class="md-header__button md-logo" aria-label="Backend-mod-api-php" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Backend-mod-api-php
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Chapter 2: State/Format Specific Parser
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Backend-mod-api-php" class="md-nav__button md-logo" aria-label="Backend-mod-api-php" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Backend-mod-api-php
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tutorial: Backend-mod-api-php
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../01_pdf_type_detector_/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 1: PDF Type Detector
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Chapter 2: State/Format Specific Parser
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Chapter 2: State/Format Specific Parser
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#the-problem-one-size-doesnt-fit-all" class="md-nav__link">
    <span class="md-ellipsis">
      The Problem: One Size Doesn't Fit All
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-solution-specialized-translators-for-each-format" class="md-nav__link">
    <span class="md-ellipsis">
      The Solution: Specialized Translators for Each Format
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-does-it-work-a-look-inside" class="md-nav__link">
    <span class="md-ellipsis">
      How Does It Work? A Look Inside
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#code-examples-peeking-at-the-specialists" class="md-nav__link">
    <span class="md-ellipsis">
      Code Examples: Peeking at the Specialists
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      Conclusion
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../03_pdfminer_parser_engine_/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 3: PDFMiner Parser Engine
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../04_ocr_parser_engine_/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 4: OCR Parser Engine
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../05_layout_analyzer_/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 5: Layout Analyzer
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../06_data_extraction___transformation_/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 6: Data Extraction &amp; Transformation
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../07_json_output_formatter_/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter 7: JSON Output Formatter
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#the-problem-one-size-doesnt-fit-all" class="md-nav__link">
    <span class="md-ellipsis">
      The Problem: One Size Doesn't Fit All
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-solution-specialized-translators-for-each-format" class="md-nav__link">
    <span class="md-ellipsis">
      The Solution: Specialized Translators for Each Format
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-does-it-work-a-look-inside" class="md-nav__link">
    <span class="md-ellipsis">
      How Does It Work? A Look Inside
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#code-examples-peeking-at-the-specialists" class="md-nav__link">
    <span class="md-ellipsis">
      Code Examples: Peeking at the Specialists
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      Conclusion
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="chapter-2-stateformat-specific-parser">Chapter 2: State/Format Specific Parser</h1>
<p>Welcome back! In <a href="../01_pdf_type_detector_/">Chapter 1: PDF Type Detector</a>, we learned how the system cleverly identifies the <em>type</em> of PDF form it receives (like NCCI, CA, MI, or a scanned image). Think of it as a sorting office that labels each package (PDF) with its destination.</p>
<p>Now, what happens after a package is labeled? It gets sent to the specialist who knows exactly how to handle <em>that specific type</em> of package. That's where the <strong>State/Format Specific Parser</strong> comes in!</p>
<h2 id="the-problem-one-size-doesnt-fit-all">The Problem: One Size Doesn't Fit All</h2>
<p>Imagine you have instruction manuals for building different pieces of furniture – a chair, a table, a bookshelf. Each manual is specific to its item. You wouldn't use the chair instructions to build the bookshelf, right?</p>
<p>Similarly, PDF mod worksheets from different states (like California - CA) or sources (like NCCI) have their data arranged in completely different ways. A "Risk ID" might be at the top-right on an NCCI form but somewhere else entirely on a CA form. Using one single method to extract data from all these different layouts would lead to chaos and incorrect information.</p>
<h2 id="the-solution-specialized-translators-for-each-format">The Solution: Specialized Translators for Each Format</h2>
<p>Once the <a href="../01_pdf_type_detector_/">PDF Type Detector</a> tells us, "Hey, this is a California (CA) form!", the system hands the PDF over to the <strong>CA Specific Parser</strong>. If it identifies an NCCI form, it goes to the <strong>NCCI Specific Parser</strong>.</p>
<p>Think of these State/Format Specific Parsers as <strong>specialized translators</strong>. Each one is fluent in the unique "layout language" of <em>one particular type</em> of document (e.g., CA, NCCI, MI, NY, PA, WI, MN, or even specific software outputs like ModMaster).</p>
<p>Key points about these parsers:</p>
<ol>
<li><strong>Dedicated:</strong> There's a separate parser script (or logic block) for each known PDF format.</li>
<li><strong>Layout Experts:</strong> Each parser contains custom <strong>Layout Analysis</strong> logic. This means it knows the <em>exact coordinates</em> (like X, Y positions on the page) or <em>specific keywords</em> to look for to find data fields like "Risk ID", "Effective Date", "Payroll", or "Losses" for <em>its specific format</em>.</li>
<li><strong>Engine Choice:</strong> Based on the initial check by the <a href="../01_pdf_type_detector_/">PDF Type Detector</a>, the specific parser knows whether to use the <a href="../03_pdfminer_parser_engine_/">PDFMiner Parser Engine</a> (to read text directly from the PDF) or the <a href="../04_ocr_parser_engine_/">OCR Parser Engine</a> (to read text from a scanned image).</li>
</ol>
<h2 id="how-does-it-work-a-look-inside">How Does It Work? A Look Inside</h2>
<p>Let's follow a PDF through this stage:</p>
<ol>
<li><strong>Input:</strong> The specific parser receives the path to the PDF file and the type identified in Chapter 1 (e.g., 'NCCI', 'CA', 'MI', or an OCR code like '1' or '2').</li>
<li><strong>Engine Selection:</strong><ul>
<li>If the type is 'NCCI', 'CA', etc. (meaning it's likely text-readable), the parser primarily uses the <a href="../03_pdfminer_parser_engine_/">PDFMiner Parser Engine</a> to get text elements and their coordinates.</li>
<li>If the type indicates OCR is needed ('1' or '2'), the parser uses the <a href="../04_ocr_parser_engine_/">OCR Parser Engine</a> to get text and coordinates from the image representation of the PDF.</li>
</ul>
</li>
<li><strong>Layout Analysis:</strong> The parser now applies its <em>unique set of rules</em>. These rules are specific to the document type it handles. It might look for:<ul>
<li>Text at <strong>specific coordinates</strong>: "Find the text around X=500, Y=700 – that should be the Risk ID."</li>
<li>Text <strong>near specific keywords</strong>: "Find the text immediately <em>after</em> the word 'Carrier:' – that's the carrier name."</li>
<li>Data within <strong>table structures</strong> identified by header keywords or lines.</li>
</ul>
</li>
<li><strong>Data Extraction:</strong> Using these rules, the parser pulls out the relevant pieces of information (like names, dates, numbers). We'll explore this more in <a href="../06_data_extraction___transformation_/">Data Extraction &amp; Transformation</a>.</li>
<li><strong>Output:</strong> The parser organizes the extracted data into a structured format (like a Python dictionary or list), ready for the final step of creating the JSON output (<a href="../07_json_output_formatter_/">JSON Output Formatter</a>).</li>
</ol>
<p>Let's visualize this with an example for an NCCI form:</p>
<pre class="mermaid"><code>sequenceDiagram
    participant System
    participant PDT as PDF Type Detector
    participant NCCI_Parser as NCCI Specific Parser
    participant PDFMiner as PDFMiner Engine
    participant ExtractedData as Structured Data

    System-&gt;&gt;PDT: Process 'ncci_form.pdf'
    PDT--&gt;&gt;System: Type is 'NCCI'
    System-&gt;&gt;NCCI_Parser: Parse 'ncci_form.pdf' (Type: NCCI)
    NCCI_Parser-&gt;&gt;PDFMiner: Get text and coordinates from PDF
    PDFMiner--&gt;&gt;NCCI_Parser: Raw Text: [ [[X1,Y1], 'Risk ID:'], [[X2,Y2], '12345'], ... ]
    NCCI_Parser-&gt;&gt;NCCI_Parser: Apply NCCI rules (Layout Analysis):\nFind text near 'Risk ID:' -&gt; '12345'
    NCCI_Parser-&gt;&gt;ExtractedData: Store: risk_id = '12345', ...
    NCCI_Parser--&gt;&gt;System: Parsing complete, data extracted.</code></pre>
<h2 id="code-examples-peeking-at-the-specialists">Code Examples: Peeking at the Specialists</h2>
<p>We have several Python scripts acting as these specialized parsers. For example:</p>
<ul>
<li><code>pdf_parser.py</code> (handles older NCCI format using PDFMiner)</li>
<li><code>pdf_parser_ncci2.py</code> (handles newer NCCI format using PDFMiner)</li>
<li><code>pdf_parser_ca.py</code> (handles California format using PDFMiner)</li>
<li><code>pdf_parser_ny.py</code> / <code>pdf_parser_ny2.py</code> (handle New York formats using PDFMiner)</li>
<li><code>pdf_parser_mi.py</code> / <code>pdf_parser_mi2.py</code> (handle Michigan formats using PDFMiner)</li>
<li><code>pdf_parser_pa.py</code> (handles Pennsylvania format using PDFMiner)</li>
<li><code>pdf_parser_wi.py</code> / <code>pdf_parser_wi2.py</code> (handle Wisconsin formats using PDFMiner)</li>
<li><code>pdf_parser_mn.py</code> (handles Minnesota format using PDFMiner)</li>
<li><code>pdf_parser_nc.py</code> (handles North Carolina format using PDFMiner)</li>
<li><code>ocrCA.py</code>, <code>ocrNC.py</code>, <code>ocrMI.py</code>, <code>ocrNCCI.py</code>, <code>ocrMN.py</code> (handle scanned versions of these formats using OCR)</li>
</ul>
<p>Let's look at <em>simplified</em> snippets to understand their core logic.</p>
<p><strong>Example 1: PDFMiner-based Parser (Simplified from <code>pdf_parser.py</code> for NCCI)</strong></p>
<p>This parser uses text coordinates extracted by the <a href="../03_pdfminer_parser_engine_/">PDFMiner Parser Engine</a>.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># (Inside a specific parser like pdf_parser.py - simplified logic)</span>
<span class="c1"># &#39;finals&#39; is a list of text elements: [[X, Y], &#39;Text&#39;, &#39;Font&#39;] sorted by position</span>

<span class="n">risk_id</span> <span class="o">=</span> <span class="s2">&quot;Not Found&quot;</span>
<span class="n">rating_effective_date</span> <span class="o">=</span> <span class="s2">&quot;Not Found&quot;</span>

<span class="c1"># Iterate through text elements found on the page</span>
<span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">finals</span><span class="p">:</span>
    <span class="n">x_coord</span> <span class="o">=</span> <span class="n">element</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">y_coord</span> <span class="o">=</span> <span class="n">element</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">element</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1"># Rule 1: Find Risk ID based on coordinates (Example coordinates)</span>
    <span class="k">if</span> <span class="mi">480</span> <span class="o">&lt;</span> <span class="n">x_coord</span> <span class="o">&lt;</span> <span class="mi">520</span> <span class="ow">and</span> <span class="mi">730</span> <span class="o">&lt;</span> <span class="n">y_coord</span> <span class="o">&lt;</span> <span class="mi">745</span><span class="p">:</span>
        <span class="n">risk_id</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="c1"># Found it!</span>

    <span class="c1"># Rule 2: Find Rating Date based on coordinates (Example coordinates)</span>
    <span class="k">if</span> <span class="mi">197</span> <span class="o">&lt;</span> <span class="n">x_coord</span> <span class="o">&lt;</span> <span class="mi">202</span> <span class="ow">and</span> <span class="mi">710</span> <span class="o">&lt;</span> <span class="n">y_coord</span> <span class="o">&lt;</span> <span class="mi">725</span><span class="p">:</span>
        <span class="n">rating_effective_date</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="c1"># Found it!</span>

<span class="c1"># ... many more rules for other fields ...</span>

<span class="c1"># Store the extracted data</span>
<span class="n">extracted_data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;risk_id&quot;</span><span class="p">:</span> <span class="n">risk_id</span><span class="p">,</span>
    <span class="s2">&quot;rating_effective_date&quot;</span><span class="p">:</span> <span class="n">rating_effective_date</span><span class="p">,</span>
    <span class="c1"># ... other data ...</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li><strong>Explanation:</strong> This code loops through the text pieces found by PDFMiner. It uses specific <code>if</code> conditions with hardcoded X and Y coordinates (like <code>480 &lt; x_coord &lt; 520</code>) to identify where specific data fields <em>should</em> be located in <em>this particular</em> (e.g., NCCI) form layout.</li>
</ul>
<p><strong>Example 2: OCR-based Parser (Simplified from <code>ocrCA.py</code> for California)</strong></p>
<p>This parser uses text and coordinates extracted by the <a href="../04_ocr_parser_engine_/">OCR Parser Engine</a>.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># (Inside an OCR parser like ocrCA.py - simplified logic)</span>
<span class="c1"># &#39;cords&#39; = list of coordinates for each word [[x1,y1], [x2,y2], ...]</span>
<span class="c1"># &#39;detected_word&#39; = list of words found by OCR [&quot;Bureau&quot;, &quot;No.&quot;, &quot;12345&quot;, ...]</span>
<span class="c1"># &#39;LIST&#39; combines these: list of [coordinates, word]</span>

<span class="n">risk_id</span> <span class="o">=</span> <span class="s2">&quot;Not Found&quot;</span>
<span class="n">rating_effective_date</span> <span class="o">=</span> <span class="s2">&quot;Not Found&quot;</span>

<span class="c1"># Rule 1: Find the coordinates of the keyword &quot;Bureau&quot;</span>
<span class="n">bureau_cord</span> <span class="o">=</span> <span class="kc">None</span>
<span class="k">for</span> <span class="n">coords</span><span class="p">,</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">LIST</span><span class="p">:</span>
    <span class="k">if</span> <span class="s2">&quot;bureau&quot;</span> <span class="ow">in</span> <span class="n">word</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
        <span class="n">bureau_cord</span> <span class="o">=</span> <span class="n">coords</span> <span class="c1"># Found the keyword location</span>
        <span class="k">break</span>

<span class="c1"># Rule 2: Look for text in a specific area RELATIVE to &quot;Bureau&quot;</span>
<span class="k">if</span> <span class="n">bureau_cord</span><span class="p">:</span>
    <span class="c1"># Define an area relative to bureau_cord where Risk ID should be</span>
    <span class="n">risk_id_area</span> <span class="o">=</span> <span class="p">[</span> <span class="p">[</span><span class="n">bureau_cord</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">100</span><span class="p">,</span> <span class="n">bureau_cord</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">10</span><span class="p">],</span> <span class="c1"># Top-Left</span>
                     <span class="p">[</span><span class="n">bureau_cord</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">250</span><span class="p">,</span> <span class="n">bureau_cord</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">10</span><span class="p">]</span> <span class="p">]</span> <span class="c1"># Bottom-Right</span>

    <span class="c1"># Search for words inside that calculated area</span>
    <span class="k">for</span> <span class="n">coords</span><span class="p">,</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">LIST</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">blockIsIn</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">risk_id_area</span><span class="p">):</span> <span class="c1"># Function checks if coords are inside area</span>
             <span class="n">risk_id</span> <span class="o">+=</span> <span class="n">word</span> <span class="c1"># Found Risk ID part</span>

<span class="c1"># ... similar logic using keywords like &quot;effective&quot; to find the date ...</span>

<span class="c1"># Store the extracted data</span>
<span class="n">extracted_data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;risk_id&quot;</span><span class="p">:</span> <span class="n">risk_id</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span>
    <span class="s2">&quot;rating_effective_date&quot;</span><span class="p">:</span> <span class="n">rating_effective_date</span><span class="p">,</span>
    <span class="c1"># ... other data ...</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li><strong>Explanation:</strong> This OCR parser first finds a known keyword ("bureau"). Then, based on where that keyword was found, it defines a rectangular area <code>risk_id_area</code> where the actual Risk ID number is expected to be on <em>this specific</em> (e.g., CA) form. It then searches the OCR results for any text falling within that calculated area.</li>
</ul>
<p>These examples show how each parser uses its <em>specific knowledge</em> of the document's layout (coordinates, keywords, relative positions) to translate the raw text data into meaningful information.</p>
<h2 id="conclusion">Conclusion</h2>
<p>The State/Format Specific Parser is the workhorse that handles the unique structure of each document type identified by the <a href="../01_pdf_type_detector_/">PDF Type Detector</a>. Like specialized translators or assembly experts, each parser knows exactly how to read and interpret <em>its</em> specific format, using either direct text extraction or OCR. It applies tailored layout rules to find and extract the necessary data fields accurately.</p>
<p>Now that we understand how the system chooses a specialist and how that specialist works, let's dive deeper into the tools they use. First, we'll explore the engine used for reading text directly from PDFs.</p>
<p><strong>Next:</strong> <a href="../03_pdfminer_parser_engine_/">Chapter 3: PDFMiner Parser Engine</a></p>
<hr />












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.c8b220af.min.js"></script>
      
        <script src="https://unpkg.com/mermaid@10.9.1/dist/mermaid.min.js"></script>
      
    
  </body>
</html>